<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Guard Hub Pro</title>
    <style>
        :root { --bg: #f8fafc; --nav: #0f172a; --primary: #10b981; --text: #334155; --card: #ffffff; --danger: #ef4444; }
        body { font-family: 'Inter', system-ui, sans-serif; margin: 0; background: var(--bg); color: var(--text); padding-bottom: 90px; }

        .header { background: var(--nav); color: white; padding: 25px 20px 45px; border-radius: 0 0 30px 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .logo { font-size: 1.2em; font-weight: 800; letter-spacing: 1px; }
        .logo span { color: var(--primary); }

        .container { padding: 0 12px; max-width: 500px; margin: -30px auto 0; }
        .page { display: none; } .page.active { display: block; }

        .search-wrap { background: var(--card); border-radius: 15px; padding: 5px 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); display: flex; align-items: center; margin-bottom: 15px; }
        #searchInput { border: none; padding: 12px 0; width: 100%; outline: none; font-size: 1em; background: transparent; color: var(--text); font-weight: 600; }
        .clear-btn { color: #94a3b8; padding: 5px; cursor: pointer; display: none; }

        .brand-scroller { display: flex; gap: 8px; overflow-x: auto; padding: 5px 0 15px; scrollbar-width: none; }
        .chip { flex: 0 0 auto; padding: 7px 15px; border-radius: 8px; background: #e2e8f0; font-size: 0.7em; font-weight: 800; color: #64748b; cursor: pointer; text-transform: uppercase; }
        .chip.active { background: var(--primary); color: white; }

        /* MAXIMUM WIDTH ID SECTION */
        .res-card { 
            background: var(--card); 
            border-radius: 18px; 
            margin-bottom: 10px; 
            display: flex; 
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.03); 
            border: 1px solid rgba(0,0,0,0.02); 
            min-height: 90px;
        }
        
        .res-left { 
            flex: 0 0 125px; /* Widened for maximum readability */
            background: #f0fdf4; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            border-right: 2px solid #dcfce7;
            padding: 10px;
        }
        .res-id-val { font-size: 2.1em; font-weight: 900; color: #166534; line-height: 1; }
        .res-common-val { 
            font-size: 0.85em; 
            color: #059669; 
            font-weight: 800; 
            margin-top: 6px; 
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            line-height: 1.2;
            width: 100%;
        }

        .res-right { 
            flex: 1; 
            padding: 12px 15px; 
            display: flex; 
            flex-direction: column; 
            justify-content: center;
        }
        .res-brand-tag { font-size: 0.65em; font-weight: 800; color: #94a3b8; text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 4px; }
        .res-model-name { 
            font-size: 1.3em; 
            font-weight: 900; 
            color: #0f172a; 
            line-height: 1.1;
        }

        /* SYNC ANIMATION & STYLE */
        .sync-card { background: var(--card); padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); border-left: 5px solid var(--primary); }
        
        .lux-btn { 
            background: var(--nav); color: white; border: none; padding: 16px; width: 100%; border-radius: 12px; 
            font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px;
            transition: all 0.3s ease;
        }

        .lux-btn.syncing {
            background: var(--primary);
            animation: pulse 1.5s infinite;
            pointer-events: none;
        }

        .lux-btn svg.spin { animation: rotate 1s linear infinite; }

        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes pulse { 
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); }
            70% { transform: scale(0.96); box-shadow: 0 0 0 15px rgba(16, 185, 129, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }

        .tab-bar { display: flex; background: #e2e8f0; padding: 4px; border-radius: 10px; margin-top: 25px; }
        .tab-bar button { flex: 1; padding: 12px; border: none; background: none; color: #64748b; font-weight: 800; font-size: 0.75em; border-radius: 7px; text-transform: uppercase; }
        .tab-bar button.active { background: white; color: var(--nav); box-shadow: 0 2px 8px rgba(0,0,0,0.05); }

        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 15px; }
        .mini { background: white; padding: 18px; border-radius: 15px; text-align: center; border: 1px solid #f1f5f9; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
        
        .bottom-nav { position: fixed; bottom: 15px; left: 15px; right: 15px; background: var(--nav); display: flex; height: 65px; border-radius: 18px; z-index: 2000; box-shadow: 0 15px 35px rgba(15, 23, 42, 0.3); }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #64748b; border: none; background: none; }
        .nav-item.active { color: var(--primary); }
        .nav-item svg { width: 20px; height: 20px; margin-bottom: 3px; }

        #toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: #1e293b; color: white; padding: 12px 24px; border-radius: 12px; font-weight: 600; font-size: 0.85em; z-index: 3000; display: none; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
    </style>
</head>
<body>

<div id="toast"></div>

<div class="header">
    <div class="logo">GUARD<span>HUB</span> PRO</div>
    <div id="db-stat" style="font-size: 0.65em; opacity: 0.6; margin-top: 5px; font-weight: 600;">Connecting...</div>
</div>

<div class="container">
    <div id="search-page" class="page active">
        <div class="search-wrap">
            <input type="text" id="searchInput" placeholder="Enter model name..." oninput="handleSearchInput()">
            <div id="clearBtn" class="clear-btn" onclick="clearSearch()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </div>
        </div>
        <div class="brand-scroller">
            <div class="chip active" onclick="setBrand('All', this)">All</div>
            <div class="chip" onclick="setBrand('Samsung', this)">Samsung</div>
            <div class="chip" onclick="setBrand('Vivo', this)">Vivo</div>
            <div class="chip" onclick="setBrand('Oppo', this)">Oppo</div>
            <div class="chip" onclick="setBrand('Realme', this)">Realme</div>
            <div class="chip" onclick="setBrand('Apple', this)">Apple</div>
        </div>
        <div id="searchResults"></div>
    </div>

    <div id="settings-page" class="page">
        <div class="sync-card">
            <h3 style="margin: 0 0 5px 0; font-size: 1.1em;">Cloud Sync</h3>
            <p style="margin: 0 0 20px 0; font-size: 0.8em; color: #94a3b8;">Force update the local inventory list.</p>
            <button class="lux-btn" id="syncBtn" onclick="fetchSheetData()">
                <svg id="syncIcon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M23 4v6h-6"></path><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path></svg>
                <span id="syncText">Sync Database</span>
            </button>
        </div>

        <div class="tab-bar">
            <button class="t-btn active" onclick="switchTab('id', this)">By Guard ID</button>
            <button class="t-btn" onclick="switchTab('common', this)">By Groups</button>
        </div>
        <div id="list-container"></div>
    </div>
</div>

<nav class="bottom-nav">
    <button class="nav-item active" id="nav-search" onclick="showPage('search')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"></circle><path d="M21 21l-4.35-4.35"></path></svg>
        <span style="font-size: 0.6em; font-weight: 800;">SEARCH</span>
    </button>
    <button class="nav-item" id="nav-settings" onclick="showPage('settings')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"></path></svg>
        <span style="font-size: 0.6em; font-weight: 800;">CONFIG</span>
    </button>
</nav>

<script>
    const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSmkI9nPrcJ_MQVtXvCb4s7wztZD4TP7gD9kRA0UUAOwka3wgB6WSEvZCbSSNP-Vg/pub?output=csv';
    let db = JSON.parse(localStorage.getItem('guardDB')) || [];
    let currentTab = 'id', selectedBrand = 'All', drillVal = null;

    function notify(msg) { const t = document.getElementById('toast'); t.innerText = msg; t.style.display = 'block'; setTimeout(() => t.style.display = 'none', 3000); }

    function handleSearchInput() {
        document.getElementById('clearBtn').style.display = document.getElementById('searchInput').value ? 'block' : 'none';
        search();
    }

    function clearSearch() { document.getElementById('searchInput').value = ''; handleSearchInput(); }

    async function fetchSheetData() {
        const btn = document.getElementById('syncBtn');
        const icon = document.getElementById('syncIcon');
        const text = document.getElementById('syncText');
        btn.classList.add('syncing'); icon.classList.add('spin'); text.innerText = "Syncing...";

        try {
            const response = await fetch(SHEET_URL);
            const data = await response.text();
            parseCSV(data);
            setTimeout(() => {
                notify("Inventory Updated");
                btn.classList.remove('syncing'); icon.classList.remove('spin'); text.innerText = "Sync Database";
            }, 800);
        } catch (err) { 
            notify("Sync Failed");
            btn.classList.remove('syncing'); icon.classList.remove('spin'); text.innerText = "Sync Database";
        }
    }

    function parseCSV(csv) {
        const lines = csv.split('\n');
        const newDb = [];
        for (let i = 1; i < lines.length; i++) {
            const cols = lines[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
            if (cols.length >= 3) {
                newDb.push({
                    brand: cols[0].replace(/"/g, '').trim(),
                    model: cols[1].replace(/"/g, '').trim(),
                    guard: cols[2].replace(/"/g, '').trim(),
                    common: cols[3] ? cols[3].replace(/"/g, '').trim() : ""
                });
            }
        }
        db = newDb;
        localStorage.setItem('guardDB', JSON.stringify(db));
        updateStats(); render();
    }

    function updateStats() { document.getElementById('db-stat').innerText = `${db.length} Models Active`; }

    function search() {
        const q = document.getElementById('searchInput').value.toLowerCase().trim();
        const res = document.getElementById('searchResults'); res.innerHTML = '';
        if(!q && selectedBrand === 'All') return;
        
        db.filter(i => (i.model.toLowerCase().includes(q) || i.brand.toLowerCase().includes(q)) && (selectedBrand === 'All' || i.brand === selectedBrand)).forEach(m => {
            const d = document.createElement('div'); d.className = 'res-card';
            d.innerHTML = `
                <div class="res-left"><div class="res-id-val">${m.guard}</div><div class="res-common-val">${m.common || ''}</div></div>
                <div class="res-right"><span class="res-brand-tag">${m.brand}</span><div class="res-model-name">${m.model}</div></div>`;
            res.appendChild(d);
        });
    }

    function render() {
        const container = document.getElementById('list-container'); container.innerHTML = '';
        const grid = document.createElement('div'); grid.className = 'grid';
        if (drillVal) {
            const head = document.createElement('div');
            head.style = "grid-column: 1/-1; padding:10px; display:flex; justify-content:space-between; font-weight:800; color:var(--nav); font-size: 0.8em;";
            head.innerHTML = `<span>Grouping: ${drillVal}</span><span onclick="drillVal=null;render()" style="color:var(--danger)">CLOSE</span>`;
            grid.appendChild(head);
            db.filter(i => String(i[currentTab === 'id' ? 'guard' : 'common']) === String(drillVal)).forEach(i => {
                const el = document.createElement('div'); el.className = 'mini';
                el.innerHTML = `<div style="font-weight:800; color:var(--primary); font-size:0.7em;">${i.brand}</div><div style="font-size:0.85em; font-weight:600;">${i.model}</div>`;
                grid.appendChild(el);
            });
        } else {
            const key = currentTab === 'id' ? 'guard' : 'common';
            const groups = {}; db.forEach(i => { if(i[key]) groups[i[key]] = (groups[i[key]] || 0) + 1; });
            Object.keys(groups).sort().forEach(k => {
                const el = document.createElement('div'); el.className = 'mini';
                el.onclick = () => { drillVal = k; render(); };
                el.innerHTML = `<div style="font-size:1.4em; font-weight:900; color:var(--nav)">${k}</div><div style="font-size:0.65em; color:var(--primary); font-weight:800;">${groups[k]} MODELS</div>`;
                grid.appendChild(el);
            });
        }
        container.appendChild(grid);
    }

    function showPage(p) {
        document.querySelectorAll('.page').forEach(pg => pg.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(p + '-page').classList.add('active');
        document.getElementById('nav-' + p).classList.add('active');
        if(p === 'settings') render();
    }

    function setBrand(b, el) { 
        selectedBrand = b; 
        document.querySelectorAll('.chip').forEach(c => c.classList.remove('active')); 
        el.classList.add('active'); 
        search(); 
    }

    function switchTab(t, btn) { 
        currentTab = t; drillVal = null; 
        document.querySelectorAll('.t-btn').forEach(b => b.classList.remove('active')); 
        btn.classList.add('active'); 
        render(); 
    }

    window.onload = () => { updateStats(); render(); };
</script>
</body>
</html>
